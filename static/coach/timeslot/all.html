<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>All Timeslots</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
    </head>

    <body class="bg-light">
        <div class="container">
            <div class="row justify-content-center mt-5">
                <div class="col-md-8">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="card-title text-center mb-4">
                                All Timeslots
                            </h3>
                            <div
                                id="message"
                                class="alert d-none"
                                role="alert"
                            ></div>
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Weekday</th>
                                            <th>Start Time</th>
                                            <th>End Time</th>
                                        </tr>
                                    </thead>
                                    <tbody id="timeslots-table-body">
                                        <tr>
                                            <td colspan="6" class="text-center">
                                                Loading timeslots...
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div
                                class="d-grid gap-2 d-md-flex justify-content-md-end mt-3"
                            >
                                <a
                                    href="/coach/timeslot/add"
                                    class="btn btn-primary"
                                    >Add Timeslot</a
                                >
                                <a href="/coach/home" class="btn btn-secondary"
                                    >Back to Home</a
                                >
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
            crossorigin="anonymous"
        ></script>
        <script>
            function getWeekdayString(weekday) {
                const weekdays = [
                    "Sunday",
                    "Monday",
                    "Tuesday",
                    "Wednesday",
                    "Thursday",
                    "Friday",
                    "Saturday",
                ];
                return weekdays[weekday] || "Unknown";
            }

            function formatTime(hour, minute) {
                const h = hour.toString().padStart(2, "0");
                const m = minute.toString().padStart(2, "0");
                return `${h}:${m}`;
            }

            async function fetchTimeslots() {
                const response = await fetch("/api/coach/timeslot/all");
                const data = await response.json();
                const timeslotsTableBody = document.getElementById(
                    "timeslots-table-body",
                );
                const messageDiv = document.getElementById("message");

                timeslotsTableBody.innerHTML = ""; // Clear previous results

                if (
                    response.ok &&
                    data.timeslots &&
                    data.timeslots.length > 0
                ) {
                    // Sort timeslots
                    data.timeslots.sort((timeslotA, timeslotB) => {
                        // Sort by weekday
                        const weekdayCompare =
                            timeslotA.weekday - timeslotB.weekday;
                        if (weekdayCompare !== 0) {
                            return weekdayCompare;
                        }

                        // Then sort by time
                        const timeA =
                            timeslotA.startHour * 60 + timeslotA.startMinute;
                        const timeB =
                            timeslotB.startHour * 60 + timeslotB.startMinute;
                        return timeA - timeB;
                    });

                    data.timeslots.forEach((timeslot) => {
                        const row = timeslotsTableBody.insertRow();
                        row.innerHTML = `
                        <td>${timeslot.id}</td>
                        <td>${getWeekdayString(timeslot.weekday)}</td>
                        <td>${formatTime(timeslot.startHour, timeslot.startMinute)}</td>
                        <td>${formatTime(timeslot.endHour, timeslot.endMinute)}</td>
                    `;
                    });
                } else if (
                    response.ok &&
                    (!data.timeslots || data.timeslots.length === 0)
                ) {
                    timeslotsTableBody.innerHTML = `<tr><td colspan="5" class="text-center">No timeslots found.</td></tr>`;
                } else {
                    messageDiv.textContent =
                        data.message || "An error occurred loading timeslots.";
                    messageDiv.className = "alert alert-danger";
                    messageDiv.classList.remove("d-none");
                    timeslotsTableBody.innerHTML = `<tr><td colspan="6" class="text-center">Error loading timeslots.</td></tr>`;
                }
            }

            fetchTimeslots();
        </script>
    </body>
</html>
